Обоснование конфигурации (Task4)

1. Выбор облака и модель IaaS
- Используем Yandex Cloud
- IaaS-ресурсы (VPC, Subnet, NAT, VM, Disk, SG) описаны декларативно в Terraform для воспроизводимости и возможности код-ревью.

2. Сетевое разделение и NAT
- VPC разделён на публичную и приватную подсети:
  - Публичная (`10.10.1.0/24`) — для egress/NAT и, при необходимости, бастиона.
  - Приватная (`10.10.2.0/24`) — для рабочих VM без внешних IP.
- NAT сделан опциональным (переменная `enable_nat`). При `enable_nat = true` разворачивается NAT Instance (VM в публичной подсети с включённой маршрутизацией и правилом `iptables MASQUERADE`) + таблица маршрутизации с правилом `0.0.0.0/0 -> <private IP NAT VM>`, прикреплённая к приватной подсети. Это даёт исходящий доступ (обновления пакетов, скачивание артефактов) без входящих подключений из интернета к приложениям.
- Обоснование: в некоторых папках создание Shared Egress NAT Gateway и управление SG может быть ограничено политиками/правами. Опциональный NAT Instance позволяет включать egress там, где это необходимо и возможно, а в учебной среде — оставить его выключенным.

- 3. Безопасность и доступ
- На старте используется default Security Group сети, чтобы избежать ограничений на управление правилами SG. Для прод-сценария рекомендуется ввести отдельные SG с явными ingress/egress политиками и доступом к SSH через бастион.
- SSH-ключ подставляется через `metadata` (пользователь ubuntu), что исключает хранение секретов в коде.

4. Виртуальная машина и диски
- Образ: `Ubuntu 22.04 LTS` через data-source семейства — нет «жёсткого» ID образа.
- Ресурсы VM параметризованы (vCPU, RAM, core_fraction) — легко масштабировать под нагрузки (BI/ETL/приложения).
- Отдельный data-диск (network-ssd) повышает отказоустойчивость (данные отделены от системного диска) и гибкость масштабирования.

5. Параметры и переносимость
- Все ключевые параметры выведены в `variables.tf` и примерах `terraform.tfvars`. Это упрощает перенос в другую среду (dev/stage/prod) и повторное использование модулей.

6. Почему IaC и Terraform
- Декларативный подход:
  - Воспроизводимость: та же конфигурация создаст идентичную инфраструктуру.
  - Масштабируемость: параметры + модули позволяют быстро тиражировать окружения для доменов (Data Mesh/платформенная команда).
  - Изменения через пул-реквесты: аудит, история, откаты.
  - Интеграция с CI/CD: автоматические проверки `fmt/validate/plan`.

7. Как это поддерживает бизнес-цели
- Быстрое масштабирование витрины данных и сервисов в доменах: инфраструктура создаётся по шаблону.
- Независимость доменов: отдельные VPC/подсети/SG на окружение и домен.
- Безопасность: приватные VM без внешних IP, сегментация, управляемый NAT.
- Time-to-Market: развёртывание минутах, а не днях, без долгих согласований по «ручным» работам.

8. Что и как можно расширить
- Добавить бастион в публичной подсети (NIC c NAT), ограничив SSH до него.
- Приватный реестр/репозитории (Object Storage, Container Registry) и SG-правила по FQDN.
- Модули Terraform для повторного использования по доменам.
- Логи/мониторинг (Cloud Logging/Monitoring), резервные копии дисков (snapshots).

